<!DOCTYPE html>
<html lang="en">
    <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
        <title>Wood.D's Record</title>
        <meta charset="utf-8" />
        <link href='http://fonts.googleapis.com/css?family=ABeeZee|Carrois+Gothic|Source+Code+Pro:400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="./theme/style/reset.css" type="text/css" />
        <link rel="stylesheet" href="./theme/style/screen.css" type="text/css" />
        <link rel="stylesheet" href="./theme/style/print.css" type="text/css" media="print" />
                                <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body>
    <header id="main">
        <div class="container">
            <div class="logo">
                <a href="/index.html" title="Home">Wood.D's Record</a>
            </div>
        </div>
    </header>

    <div class="splash">
        <div class="container">
            <div class="welcome">木秀于林</div>
        </div>
    </div>

    <div class="container content">
                    
    <article>
        <header>
            <h2><a href="/shi-yong-webqqxie-yi-qiao-jie-xmpphe-qqqun.html" rel="bookmark">
    使用WebQQ协议桥接XMPP和QQ群
</a></h2>
<time datetime="2013-03-14 16:09:00" pubdate>Posted on
    四 14 三月 2013
</time>
<address class="vcard author">
    by <a class="url fn" href="./author/woodd.html">
    Wood.D</a>
</address>
<span class="category">in <a href="./category/python.html">
    Python</a>.
        </span>
        </header>

        <div class="body">
            <h2>介绍</h2>
<p>无意中看见有人利用WebQQ协议开发出Linux下Pidgin的插件, 让Pidgin来收发QQ消息, 突然想将<a href="/python-shi-yong-pyxmpp2bian-xie-gtalkqun.html">clubot</a>和QQ群来桥接起来一定非常有趣,这样就可以通过gtalk收发QQ来的消息, 不过前期还是想将<code>clubot</code>和QQ群桥接起来.</p>
<h2>实施</h2>
<p>想到了就开始弄呗, 于是上网找了写有关WebQQ的协议, 首先写出了一个根据<code>urllib2</code>的版本并使用线程同时跑WebQQ和xmpp, 源码可以查看:
<a href="https://github.com/coldnight/qxbot/tree/threading_version">thread_version</a></p>
<h2>优化</h2>
<p>上面的线程版效率不是很高, 由于都是网络请求, 所以想加入可以加入到pyxmpp2的mainloop中, 使用复用I/O模型来提高效率, 首先需要解决的是将http请求通过urllib2改为socket, 于是写出HTTPSock类来实现这个需求:</p>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding:utf-8 -*-</span>
<span class="c">#</span>
<span class="c">#   Author  :   Wood.D</span>
<span class="c">#   E-mail  :   wh_linux@126.com</span>
<span class="c">#   Date    :   13/03/04 09:58:26</span>
<span class="c">#   Desc    :   Http Socket 实现 ...</span></pre></div>
        </div>

        <p>
            <a href="./shi-yong-webqqxie-yi-qiao-jie-xmpphe-qqqun.html#disqus_thread">comments</a>
        </p>
    </article>
        
    <article>
        <header>
            <h2><a href="/bo-ke-shi-yong-pelicanjing-tai-sheng-cheng-xi-tong.html" rel="bookmark">
    博客使用Pelican静态生成系统
</a></h2>
<time datetime="2013-03-14 15:12:00" pubdate>Posted on
    四 14 三月 2013
</time>
<address class="vcard author">
    by <a class="url fn" href="./author/woodd.html">
    Wood.D</a>
</address>
<span class="category">in <a href="./category/python.html">
    Python</a>.
        </span>
        </header>

        <div class="body">
            <h1>介绍</h1>
<p>最近流行使用静态生成的博客, 看了很多感觉很棒总想尝试一下, 大名鼎鼎的<code>Jekyll</code>使用ruby,看了很多文档介绍,依旧不能入门使用,也许是用Ruby编写,对它比较迟钝.看到了一款Python编写的静态生成系统<code>Pelican</code>, 试用后除了模板较少外感觉还是不错的,使用<code>Markdown</code>和<code>Rst</code>编写.</p>
<h1>安装</h1>
<p>可以试用<code>pip</code>来安装<code>Pelican</code>, 通过<code>pelican-quickstart</code>脚本可以快速构建一个站点,详细不在描述.可以看看它的文档</p>
<h2>模板</h2>
<p>模板采用<code>neat</code>,这个模板设计简单(看我的页面就知道有多简单了)我非常喜欢, 但是有几个链接<code>bug</code>,bug不是很难找,很轻松就能找出来, 这里不列出来, 基于这个模板我做了一点更改.</p>
<h1>使用</h1>
<p>在执行<code>pelican-quickstart</code>是开启Makefile, 可以通过make很简单的生成html.</p>
<div class="codehilite"><pre>make html   <span class="c"># 生成html</span>
make clean ...</pre></div>
        </div>

        <p>
            <a href="./bo-ke-shi-yong-pelicanjing-tai-sheng-cheng-xi-tong.html#disqus_thread">comments</a>
        </p>
    </article>
        
    <article>
        <header>
            <h2><a href="/vlog-ge-shi-yong-pythonbian-xie-de-qing-liang-ji-bo-ke-xi-tong.html" rel="bookmark">
    vLog 一个使用Python编写的轻量级博客系统
</a></h2>
<time datetime="2013-02-05 16:43:00" pubdate>Posted on
    二 05 二月 2013
</time>
<address class="vcard author">
    by <a class="url fn" href="./author/woodd.html">
    Wood.D</a>
</address>
<span class="category">in <a href="./category/python.html">
    Python</a>.
        </span>
        </header>

        <div class="body">
            <h2>介绍</h2>
<h3>何为vLog</h3>
<p>大家有人可能注意到博客改变了,是的前面也有文章提到从wordpress迁移到vlog,但是何为vLog这里给大家简要的说明一下,vLog是我使用<code>Python</code>的<code>tornado</code>框架和<code>Jinja2</code>模板引擎,基于MySQL数据的一个轻量级的博客系统,此系统功能比较薄弱,处于开发初期,使用<code>Markdown</code>的格式来抒写博文.</p>
<h3>为什么vLog</h3>
<p>vLog后台十分简单(可以说是简陋),功能也简单,就是一款简单的博客系统,提供了Python终端脚本,可以在终端来抒写博文, vLog使用一套非常简单的缓存系统,缓存使用memcached使得页面加载速度非常快.</p>
<h3>为什么不vLog</h3>
<p>相对与wordpress vlog非常简陋,仅仅提供简单的博客功能,而且使用Python编写主机方面支援不太多,虽然有<code>SAE</code>和<code>GAE</code>的支援,但是我没弄过,所以没有支援<code>SAE</code>和<code>GAE</code>(如果你有兴趣,可以添加相关支持)</p>
<h2>安装</h2>
<h3>平台</h3>
<ul>
<li>Linux</li>
<li>python2.7</li>
<li>MySQL ...</li></ul>
        </div>

        <p>
            <a href="./vlog-ge-shi-yong-pythonbian-xie-de-qing-liang-ji-bo-ke-xi-tong.html#disqus_thread">comments</a>
        </p>
    </article>
        
    <article>
        <header>
            <h2><a href="/shi-yong-geng-jia-gao-xiao-de-epollzuo-wei-pyxmpp2de-zhu-xun-huan.html" rel="bookmark">
    使用更加高效的epoll作为pyxmpp2的主循环
</a></h2>
<time datetime="2013-02-05 16:06:00" pubdate>Posted on
    二 05 二月 2013
</time>
<address class="vcard author">
    by <a class="url fn" href="./author/woodd.html">
    Wood.D</a>
</address>
<span class="category">in <a href="./category/linuxpython.html">
    Linux,Python</a>.
        </span>
        </header>

        <div class="body">
            <h2>引子</h2>
<p>之前<a href="/python-shi-yong-pyxmpp2bian-xie-gtalkqun.html">clubot</a>使用的pyxmpp2的默认mainloop也就是一个poll的主循环,但是<code>clubot</code>上线后资源占用非常厉害,使用<code>strace</code>跟踪发现<code>clubot</code>在不停的<code>poll</code>,查看<code>pyxmpp2</code>代码发现<code>pyxmpp2</code>的<code>poll</code>在使用超时阻塞时使用<code>最小</code>超时时间,而<code>最小</code>超时时间一直是0,所以会变成一个没有超时的非阻塞<code>poll</code>很浪费资源,不打算更改库代码,所以自己仿照poll的mainloop写了一个更加高效的<code>epoll</code>的mainloop</p>
<h2>实现</h2>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding:utf-8 -*-</span>
<span class="c">#</span>
<span class="c">#   Author  :   cold</span>
<span class="c">#   E-mail  :   wh_linux@126.com</span>
<span class="c">#   Date    :   13/01/06 10 ...</span></pre></div>
        </div>

        <p>
            <a href="./shi-yong-geng-jia-gao-xiao-de-epollzuo-wei-pyxmpp2de-zhu-xun-huan.html#disqus_thread">comments</a>
        </p>
    </article>
        
    <article>
        <header>
            <h2><a href="/python-zhong-fu-an-zhuang-bao-bao-cuo.html" rel="bookmark">
    Python 重复安装包报错
</a></h2>
<time datetime="2013-01-25 14:55:00" pubdate>Posted on
    五 25 一月 2013
</time>
<address class="vcard author">
    by <a class="url fn" href="./author/woodd.html">
    Wood.D</a>
</address>
<span class="category">in <a href="./category/linuxpython.html">
    Linux,Python</a>.
        </span>
        </header>

        <div class="body">
            <p>最近写程序用到argparse总是会报错</p>
<div class="codehilite"><pre><span class="sr">/usr/</span><span class="n">lib</span><span class="sr">/python2.7/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="sr">/pygments/</span><span class="n">plugin</span><span class="o">.</span><span class="n">py:39:</span> <span class="n">UserWarning:</span> <span class="n">Module</span> <span class="n">argparse</span> <span class="n">was</span> <span class="n">already</span> <span class="n">imported</span> <span class="n">from</span> <span class="sr">/usr/</span><span class="n">lib</span><span class="sr">/python2.7/</span><span class="n">argparse</span><span class="o">.</span><span class="n">pyc</span><span class="p">,</span> <span class="n">but</span> <span class="sr">/usr/</span><span class="nb">local</span><span class="sr">/lib/</span><span class="n">python2</span><span class="mf">.7</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span> <span class="n">is</span> <span class="n">being</span> <span class="n">added</span> <span class="n">to</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
</pre></div>


<p>一开始也没怎么在意,不影响什么,但是后来总是出来严重影响心情,google 了没啥明确的报错,后来仔细看报错信息,想起来以前可能庄过argparse这个包测试,但是没有删除
执行<code>ls /usr/local ...</code></p>
        </div>

        <p>
            <a href="./python-zhong-fu-an-zhuang-bao-bao-cuo.html#disqus_thread">comments</a>
        </p>
    </article>
        
    <article>
        <header>
            <h2><a href="/linux-xia-shi-yong-pythonjie-tu-zi-dong-fen-xiang.html" rel="bookmark">
    Linux 下使用Python截图自动分享
</a></h2>
<time datetime="2013-01-22 16:59:00" pubdate>Posted on
    二 22 一月 2013
</time>
<address class="vcard author">
    by <a class="url fn" href="./author/woodd.html">
    Wood.D</a>
</address>
<span class="category">in <a href="./category/linuxpython.html">
    Linux,Python</a>.
        </span>
        </header>

        <div class="body">
            <h2>引子</h2>
<p>Linux下不支持QQ等功能丰富的IM,虽然可以通过wine运行QQ2012,但是还是喜欢在gtalk群中聊天,gtalk群不支持图片方式,这就要靠我们大家自己来解决了,<a href="http://eleveni386.7axu.com">eleven</a>开放了一个Image上传和显示接口,提供了使用<code>curl</code>来解决,但是我们公司的网络使用<code>squid</code>禁止了<code>curl</code>的访问,所以整天看他们这么爽的分享图片我也不甘心阿,所以就使用Python写了一个分享图片的脚本</p>
<h2>实现</h2>
<p>使用scrot截图,然后使用urllib2库上传图片,如果存在PyQt4库则会将结果放到剪贴板上,如果不存在则输出,自行复制</p>
<h2>代码</h2>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding:utf-8 -*-</span>
<span class="c">#</span>
<span class="c">#   Author  :   cold</span>
<span class="c">#   E-mail  :   wh_linux@126.com</span>
<span class="c">#   Date    :   13/01/21 09:54:39</span>
<span class="c">#   Desc    :   贴代码和图片</span>
<span class="c">#</span>
<span class="kn">import</span> <span class="nn">urllib2</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">import ...</span></pre></div>
        </div>

        <p>
            <a href="./linux-xia-shi-yong-pythonjie-tu-zi-dong-fen-xiang.html#disqus_thread">comments</a>
        </p>
    </article>
        
    <article>
        <header>
            <h2><a href="/vlogshi-yong-tornadokuang-jia-jie-he-memcachedhuan-cun-ye-mian.html" rel="bookmark">
    vLog使用Tornado框架结合memcached缓存页面
</a></h2>
<time datetime="2013-01-16 16:14:00" pubdate>Posted on
    三 16 一月 2013
</time>
<address class="vcard author">
    by <a class="url fn" href="./author/woodd.html">
    Wood.D</a>
</address>
<span class="category">in <a href="./category/linuxmysqlpython.html">
    Linux,MySQL,Python</a>.
        </span>
        </header>

        <div class="body">
            <h2>原因</h2>
<p>Blog是一个更新并不很频繁的一套系统,但是每次刷新页面都要更新数据库反而很浪费资源,添加静态页面生成是一个解决办法,同时缓存是一个更好的主意,可以结合Memcached添加少量的代码进行缓存,而且免去去了每次更新文章都要重新生成静态页面,特别当页面特别多时.</p>
<h2>实现</h2>
<p>主要通过页面的uri进行缓存,结合tornado.web.RequestHandler的prepare和on_finish方法函数,
prepare 主要是请求前执行,on_finish()是请求结束之前执行.在渲染模板时缓存页面内容,然后在请求前检测是否有缓存,如果有直接输出缓存,结束请求,在POST提交之后清空所有缓存,重新生成缓存,从而保证内容实时性.由于登录用户和普通用户的页面不相同,所以不缓存登录用户页面(代码中没有体现,请自行实现).主要python代码(省略了模板渲染的代码):</p>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding:utf-8 -*-</span>
<span class="c">#</span>
<span class="c">#   Author  :   cold</span>
<span class="c">#   E-mail  :   wh_linux@126.com</span>
<span class="c">#   Date    :   13/01/14 09:57:31</span>
<span class="c">#   Desc ...</span></pre></div>
        </div>

        <p>
            <a href="./vlogshi-yong-tornadokuang-jia-jie-he-memcachedhuan-cun-ye-mian.html#disqus_thread">comments</a>
        </p>
    </article>
        
    <article>
        <header>
            <h2><a href="/cong-wordpressqian-yi-dao-vlog.html" rel="bookmark">
    从wordpress迁移到vLog
</a></h2>
<time datetime="2013-01-16 16:10:00" pubdate>Posted on
    三 16 一月 2013
</time>
<address class="vcard author">
    by <a class="url fn" href="./author/woodd.html">
    Wood.D</a>
</address>
<span class="category">in <a href="./category/wei-fen-lei.html">
    未分类</a>.
        </span>
        </header>

        <div class="body">
            <p>博客今天开始迁移到你现在看到的平台,是一个建立在<code>Tornado</code>和<code>MySQL</code>,使用<code>Jinja2</code>作为模板引擎的轻量级博客系统,完全使用Mardown格式书写.刚刚写完就迫不及待的迁移过来,导致现在很多功能不完善,比如你回复的时候会出现不自动跳转,这是因为博主是个很懒很不喜欢写JS的原因,所以着急迁移也就没有完善和修复这一部分功能,先这样跑着吧,优化以后慢慢搞.</p>
<hr />
<p>至于为什么叫vLog,是因为打算一开始不提供后台页面,所有后台操作提供接口,使用Vim调用的.但是后来还是忍不住写了后台,Vim倒是还没有实现,所以留待以后慢慢写吧.</p>
<hr />
<p>前台模板是从<a href="http://saepy.sinaapp.com">saepy</a>上扒下来的,本来是想直接改这个程序的,但是后来还是放弃了,自己写.</p>
<p><strong>希望您喜欢现在的博客</strong></p>
        </div>

        <p>
            <a href="./cong-wordpressqian-yi-dao-vlog.html#disqus_thread">comments</a>
        </p>
    </article>
        
    <article>
        <header>
            <h2><a href="/vimpei-zhi-xi-lie-er-hao-kan-de-statusline.html" rel="bookmark">
    Vim配置系列(二) —- 好看的statusline
</a></h2>
<time datetime="2013-01-05 15:01:00" pubdate>Posted on
    六 05 一月 2013
</time>
<address class="vcard author">
    by <a class="url fn" href="./author/woodd.html">
    Wood.D</a>
</address>
<span class="category">in <a href="./category/vim.html">
    Vim</a>.
        </span>
        </header>

        <div class="body">
            <p>Vim是一款文本编辑器,但是这并不影响它有一个好看的外观,大家都知道Vim可以通过配色方案来改变Vim的外观,满足一些"好色之徒",之前大家可能也主意到截图中一个非常漂亮的statusline,这是通过Vim的一个Powerline的插件实现的.之前我们配置了Vundle的插件管理(传送门)我们可以用Vundle安装Powerline,在.vimrc(Windows可能是_vimrc)中添加:</p>
<div class="codehilite"><pre>Bundle <span class="c">&quot;Lokaltog/vim-powerline&quot;</span>
</pre></div>


<p>然后重新打开vim执行</p>
<div class="codehilite"><pre><span class="p">:</span>BundleInstall
</pre></div>


<p>如果你和github畅通的话就会顺利安装插件,然后在.vimrc里添加</p>
<div class="codehilite"><pre><span class="k">set</span> <span class="nb">laststatus</span><span class="p">=</span><span class="m">2</span>
<span class="k">let</span> g:Powerline_symbols<span class="p">=</span><span class="s1">&#39;unicode&#39;</span>
</pre></div>


<p>如果gvim打开需要使用/path/to/your/bundle/vim-powerline/fontpatcher/fontpatcher给当前gvim使用的字体打上补丁(依赖需要fontforge和python)</p>
<p>然后重新打开vim你就会发现一个漂亮的statusline</p>
<p><img alt="好看的statusline" src="/upload/VimPythonComment1.png" /></p>
        </div>

        <p>
            <a href="./vimpei-zhi-xi-lie-er-hao-kan-de-statusline.html#disqus_thread">comments</a>
        </p>
    </article>
        
    <article>
        <header>
            <h2><a href="/vim-jie-he-pythonbian-xie-de-fan-yi-cha-jian.html" rel="bookmark">
    Vim 结合Python编写的翻译插件
</a></h2>
<time datetime="2013-01-04 17:58:00" pubdate>Posted on
    五 04 一月 2013
</time>
<address class="vcard author">
    by <a class="url fn" href="./author/woodd.html">
    Wood.D</a>
</address>
<span class="category">in <a href="./category/linuxvimpython.html">
    Linux,Vim,Python</a>.
        </span>
        </header>

        <div class="body">
            <p>最近重写了一下之前用Python写的一个终端翻译工具,想着Vim7.3 支持Python于是想将这个功能写为一个插件让Vim也支持翻译功能,现在英汉翻译比较完善, <Leader>t会翻译光标下单词,选中的翻译还不完善,仅仅是个半成品,在此抛砖引玉.将下面代码复制保存为translate.vim 放到~/.vim/plugin目录下即可,代码如下:</p>
<div class="codehilite"><pre><span class="c">&quot;   Author  :   cold</span>
<span class="c">&quot;   E-mail  :   wh_linux@126.com</span>
<span class="c">&quot;   Date    :   2012/12/20 16:23</span>
<span class="c">&quot;   Desc    :   英汉/汉英翻译插件</span>
<span class="c">&quot;   Useage  :</span>
<span class="c">&quot;                  &lt;Leader&gt; t 翻译当前光标下内容 //XXX 中文不行</span>
<span class="c">&quot;                  &lt;Leader&gt; lt 翻译当前行</span>
<span class="c">&quot;                  &lt;Leader&gt; vt 翻译选中的内容</span>

<span class="k">function</span> GetCursorWord<span class="p">()</span>
    <span class="k">let</span> column <span class="p">=</span> get<span class="p">(</span>getpos<span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span> <span class="m">2</span><span class="p">,</span> <span class="m">0 ...</span></pre></div>
        </div>

        <p>
            <a href="./vim-jie-he-pythonbian-xie-de-fan-yi-cha-jian.html#disqus_thread">comments</a>
        </p>
    </article>
        <script type="text/javascript">
        var disqus_shortname = 'linuxzen';
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
            (document.head || document.body).appendChild(s);
        }());
    </script>
        </div>

    <div class="container footnote">
                            <span class="paginator">
        Page 1 / 7
        <a href="./index2.html">&raquo;</a>
    </span>
    </div>

    <div class="bottom">
        <div class="container">
            <div class="about">
                <h3>About me</h3>
                <img alt="Me!" class="avatar"
                     src="http://www.gravatar.com/avatar/d82fd064a3fd1b02c9e77a2d3197e33e?size=64">
                <p>喜欢Linux和Python,用Vim编写程序,曾长时间使用cold这个id,现使用Wood.D作为以后长期id,现在维护一个gtalk群,有兴趣的可以加入,使用xmpp帐号添加:clubot@vim-cn.com`</p>
                                <p>
                   You can contact me by emailing
                   <a href="mailto:wh_linux@126.com">wh_linux@126.com</a>.
                </p>
                <p>
                                                            <a href="https://github.com/coldnight"
                       title="coldnight's Profile">fork me on GitHub</a>!
                                    </p>
            </div>
        </div>
    </div>

    <footer>
        <div class="container footer">
            <span>Powered by <a href="http://docs.getpelican.com">
                Pelican</a> using <a href="https://github.com/BYK/pelican-neat">
                neat theme</a>.
            </span>
            <nav>
                <ul>
                    <li><a href="archives.html" title="Archive"><strong>Archive</strong></a></li>
                                        <li><a href="https://github.com/coldnight/coldnight.github.com" title="Source code">Source code</a></li>
                                    </ul>
            </nav>
                    </div>
    </footer>

    </body>
</html>